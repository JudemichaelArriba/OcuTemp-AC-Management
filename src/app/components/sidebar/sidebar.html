<aside
  class="border-r border-gray-200 flex flex-col bg-white shrink-0 justify-between h-screen rounded-xl shadow-lg overflow-hidden transition-all duration-300"
  [class.w-64]="isOpen()"
  [class.w-16]="!isOpen()"
>


  <div class="p-3 flex items-center border-b border-gray-100"
       [class.justify-between]="isOpen()"
       [class.justify-center]="!isOpen()"
       [class.px-4]="isOpen()">


    <div class="flex items-center gap-3 min-w-0">
      <div class="size-9 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center shadow-md shadow-blue-300/40 shrink-0">
        <span class="material-symbols-outlined text-white text-lg">thermostat</span>
      </div>
      <div *ngIf="isOpen()" class="overflow-hidden">
        <h1 class="text-base font-bold leading-none tracking-tight text-gray-900 whitespace-nowrap">OcuTemp</h1>
        <p class="text-[8.5px] font-semibold uppercase tracking-widest text-blue-600/70 mt-1 whitespace-nowrap">
          IoT Admin Panel
        </p>
      </div>
    </div>


    <button
      *ngIf="isOpen()"
      (click)="toggleSidebar()"
      class="p-1.5 rounded-lg text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-all ml-2 shrink-0"
      title="Collapse sidebar"
    >

      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <line x1="9" y1="3" x2="9" y2="21"/>
      </svg>
    </button>
  </div>


  <div *ngIf="!isOpen()" class="flex justify-center py-2 border-b border-gray-100">
    <button
      (click)="toggleSidebar()"
      class="p-1.5 rounded-lg text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-all"
      title="Expand sidebar"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <line x1="9" y1="3" x2="9" y2="21"/>
      </svg>
    </button>
  </div>


  <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">

    <a
      class="relative flex items-center gap-3 px-3 py-2.5 text-gray-600
             hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100/50
             hover:text-blue-700 rounded-lg transition-all group"
      [class.justify-center]="!isOpen()"
      [class.justify-start]="isOpen()"
      [routerLink]="['/app/dashboard']"
      routerLinkActive="bg-gradient-to-r from-blue-50 to-blue-100/50 !text-blue-700 font-medium"
      [title]="'Dashboard'"
    >
      <span class="material-symbols-outlined text-[18px] group-hover:scale-110 transition-transform shrink-0">
        dashboard
      </span>
      <span *ngIf="isOpen()" class="text-[13px] font-semibold whitespace-nowrap" routerLinkActive="!font-bold">
        Dashboard
      </span>
      <span
        class="absolute left-0 top-0 h-full w-[3px] bg-gradient-to-b from-blue-600 to-blue-500 rounded-l-full hidden"
        routerLinkActive="!block"
      ></span>
    </a>

    <a
      class="relative flex items-center gap-3 px-3 py-2.5 text-gray-600
             hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100/50
             hover:text-blue-700 rounded-lg transition-all group"
      [class.justify-center]="!isOpen()"
      [class.justify-start]="isOpen()"
      [routerLink]="['/app/room-management']"
      routerLinkActive="bg-gradient-to-r from-blue-50 to-blue-100/50 !text-blue-700 font-medium"
      [title]="'Room Management'"
    >
      <span class="material-symbols-outlined text-[18px] group-hover:scale-110 transition-transform shrink-0">
        meeting_room
      </span>
      <span *ngIf="isOpen()" class="text-[13px] font-semibold whitespace-nowrap" routerLinkActive="!font-bold">
        Room Management
      </span>
      <span
        class="absolute left-0 top-0 h-full w-[3px] bg-gradient-to-b from-blue-600 to-blue-500 rounded-l-full hidden"
        routerLinkActive="!block"
      ></span>
    </a>

    <a
      class="relative flex items-center gap-3 px-3 py-2.5 text-gray-600
             hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100/50
             hover:text-blue-700 rounded-lg transition-all group"
      [class.justify-center]="!isOpen()"
      [class.justify-start]="isOpen()"
      [routerLink]="['/app/energy-reports']"
      routerLinkActive="bg-gradient-to-r from-blue-50 to-blue-100/50 !text-blue-700 font-medium"
      [title]="'Energy Reports'"
    >
      <span class="material-symbols-outlined text-[18px] group-hover:scale-110 transition-transform shrink-0">
        bar_chart
      </span>
      <span *ngIf="isOpen()" class="text-[13px] font-semibold whitespace-nowrap" routerLinkActive="!font-bold">
        Energy Reports
      </span>
      <span
        class="absolute left-0 top-0 h-full w-[3px] bg-gradient-to-b from-blue-600 to-blue-500 rounded-l-full hidden"
        routerLinkActive="!block"
      ></span>
    </a>


    <ng-container *ngIf="currentUser$ | async as currentUser">
      <a
        *ngIf="isAdmin(currentUser)"
        class="relative flex items-center gap-3 px-3 py-2.5 text-gray-600
               hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100/50
               hover:text-blue-700 rounded-lg transition-all group"
        [class.justify-center]="!isOpen()"
        [class.justify-start]="isOpen()"
        [routerLink]="['/app/user-management']"
        routerLinkActive="bg-gradient-to-r from-blue-50 to-blue-100/50 !text-blue-700 font-medium"
        [title]="'User Management'"
      >
        <span class="material-symbols-outlined text-[18px] group-hover:scale-110 transition-transform shrink-0">
          group
        </span>
        <span *ngIf="isOpen()" class="text-[13px] font-semibold whitespace-nowrap" routerLinkActive="!font-bold">
          User Management
        </span>
        <span
          class="absolute left-0 top-0 h-full w-[3px] bg-gradient-to-b from-blue-600 to-blue-500 rounded-l-full hidden"
          routerLinkActive="!block"
        ></span>
      </a>
    </ng-container>


    <div class="pt-3 pb-2">
      <div class="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>
    </div>

    <a
      class="relative flex items-center gap-3 px-3 py-2.5 text-gray-600
             hover:bg-gradient-to-r hover:from-gray-50 hover:to-gray-100/50
             hover:text-blue-700 rounded-lg transition-all group"
      [class.justify-center]="!isOpen()"
      [class.justify-start]="isOpen()"
      [routerLink]="['/app/settings']"
      routerLinkActive="bg-gradient-to-r from-blue-50 to-blue-100/50 !text-blue-700 font-medium"
      [title]="'Settings'"
    >
      <span class="material-symbols-outlined text-[18px] group-hover:scale-110 transition-transform shrink-0">
        settings
      </span>
      <span *ngIf="isOpen()" class="text-[13px] font-semibold whitespace-nowrap" routerLinkActive="!font-bold">
        Settings
      </span>
      <span
        class="absolute left-0 top-0 h-full w-[3px] bg-gradient-to-b from-blue-600 to-blue-500 rounded-l-full hidden"
        routerLinkActive="!block"
      ></span>
    </a>
  </nav>


  <div class="border-t border-gray-100 p-3">
    <ng-container *ngIf="currentUser$ | async as currentUser; else loadingUser">
      <div
        class="relative flex items-center gap-3 p-3 rounded-xl
              bg-gradient-to-br from-gray-50/50 to-white
              border border-gray-100/80
              hover:shadow-md hover:shadow-blue-100/50
              hover:border-blue-200/60
              cursor-pointer transition-all duration-300
              group"
        [class.flex-col]="!isOpen()"
        [class.flex-row]="isOpen()"
      >
    
        <div class="relative shrink-0">
          <div class="absolute -inset-0.5 bg-gradient-to-br from-blue-600 to-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-sm"></div>
          <div
            class="relative w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-blue-500
                  text-white font-bold flex items-center justify-center
                  shadow-md shadow-blue-200/50
                  ring-2 ring-white
                  group-hover:scale-105 transition-transform duration-300 text-sm"
          >
            {{ getUserInitials(currentUser) }}
          </div>
          <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 rounded-full border-2 border-white shadow-sm"></div>
        </div>

  
        <div *ngIf="isOpen()" class="flex-1 overflow-hidden">
          <p class="text-[13px] font-bold text-gray-900 truncate leading-tight group-hover:text-blue-700 transition-colors">
            {{ currentUser.fullName }}
          </p>
          <p class="text-[10.5px] font-semibold text-gray-500 truncate mt-0.5 uppercase tracking-wide">
            {{ currentUser.role }}
          </p>
        </div>

        <div *ngIf="isOpen()" class="opacity-0 group-hover:opacity-100 transition-opacity">
          <span class="material-symbols-outlined text-gray-400 text-[16px]">chevron_right</span>
        </div>
      </div>
    </ng-container>

    <ng-template #loadingUser>
      <div
        class="relative flex items-center gap-3 p-3 rounded-xl
              bg-gray-100/50 animate-pulse
              border border-gray-100/80"
        [class.flex-col]="!isOpen()"
        [class.flex-row]="isOpen()"
      >
        <div class="w-10 h-10 rounded-full bg-gray-300 shrink-0"></div>
        <div *ngIf="isOpen()" class="flex-1 space-y-2">
          <div class="h-3 w-24 bg-gray-300 rounded"></div>
          <div class="h-2 w-16 bg-gray-200 rounded"></div>
        </div>
      </div>
    </ng-template>
  </div>

</aside>